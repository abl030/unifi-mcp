"""Integration tests for REST setting endpoint (auto-generated).

DO NOT EDIT THIS FILE. All changes must be made in the generator.
"""

from __future__ import annotations

import time
import uuid

import httpx
import pytest


class TestSettings:
    """Tests for the settings resource."""

    def test_list_settings(self, authenticated_client):
        """Verify listing all settings returns 200 + valid data."""
        data = authenticated_client.api_get("rest/setting")
        assert isinstance(data, list)
        # Settings should have at least a few categories
        assert len(data) > 0

    def test_settings_have_key_field(self, authenticated_client):
        """Every setting record should have a 'key' field."""
        data = authenticated_client.api_get("rest/setting")
        for item in data:
            assert "key" in item, f"Setting missing 'key' field: {item.get('_id')}"
            assert "_id" in item

    def test_get_setting_by_key(self, authenticated_client):
        """Can retrieve a specific setting by key."""
        data = authenticated_client.api_get("rest/setting")
        if not data:
            pytest.skip("No settings available")
        first_key = data[0]["key"]
        # Re-fetch and filter
        all_settings = authenticated_client.api_get("rest/setting")
        found = [s for s in all_settings if s.get("key") == first_key]
        assert len(found) == 1
        assert found[0]["key"] == first_key
