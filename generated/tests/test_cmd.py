"""Integration tests for command endpoints (auto-generated).

Only safe, non-destructive commands are tested.

DO NOT EDIT THIS FILE. All changes must be made in the generator.
"""

from __future__ import annotations

import httpx
import pytest


class TestCmdListbackups:
    """Test the 'list-backups' command via backup."""

    def test_list_backups(self, authenticated_client):
        """Execute list-backups and verify response."""
        payload = {"cmd": "list-backups"}
        try:
            result = authenticated_client.api_post("cmd/backup", payload)
            assert result is not None
        except (RuntimeError, httpx.HTTPStatusError) as e:
            # Commands may fail without real devices — that's expected
            pytest.skip(f"Command not available in test environment: {e}")


class TestCmdGetspeedteststatus:
    """Test the 'speedtest-status' command via devmgr."""

    def test_get_speedtest_status(self, authenticated_client):
        """Execute speedtest-status and verify response."""
        payload = {"cmd": "speedtest-status"}
        try:
            result = authenticated_client.api_post("cmd/devmgr", payload)
            assert result is not None
        except (RuntimeError, httpx.HTTPStatusError) as e:
            # Commands may fail without real devices — that's expected
            pytest.skip(f"Command not available in test environment: {e}")


class TestCmdLocatedevice:
    """Test the 'set-locate' command via devmgr."""

    def test_locate_device(self, authenticated_client):
        """Execute set-locate — validates endpoint handles missing device correctly."""
        payload = {"cmd": "set-locate"}
        payload["mac"] = "00:00:00:00:00:00"  # dummy MAC
        # Send request directly to inspect the response status
        resp = authenticated_client.client.post(
            f"/api/s/{authenticated_client.site}/cmd/devmgr",
            json=payload,
            headers=authenticated_client._headers(),
        )
        # 200 = command accepted, 400 = unknown device (expected without hardware)
        assert resp.status_code in (200, 400), f"Unexpected status {resp.status_code}"
        if resp.status_code == 400:
            body = resp.json()
            assert body.get("meta", {}).get("rc") == "error"


class TestCmdUnlocatedevice:
    """Test the 'unset-locate' command via devmgr."""

    def test_unlocate_device(self, authenticated_client):
        """Execute unset-locate — validates endpoint handles missing device correctly."""
        payload = {"cmd": "unset-locate"}
        payload["mac"] = "00:00:00:00:00:00"  # dummy MAC
        # Send request directly to inspect the response status
        resp = authenticated_client.client.post(
            f"/api/s/{authenticated_client.site}/cmd/devmgr",
            json=payload,
            headers=authenticated_client._headers(),
        )
        # 200 = command accepted, 400 = unknown device (expected without hardware)
        assert resp.status_code in (200, 400), f"Unexpected status {resp.status_code}"
        if resp.status_code == 400:
            body = resp.json()
            assert body.get("meta", {}).get("rc") == "error"


class TestCmdCheckfirmwareupdate:
    """Test the 'check-firmware-update' command via devmgr."""

    def test_check_firmware_update(self, authenticated_client):
        """Execute check-firmware-update and verify response."""
        payload = {"cmd": "check-firmware-update"}
        try:
            result = authenticated_client.api_post("cmd/devmgr", payload)
            assert result is not None
        except (RuntimeError, httpx.HTTPStatusError) as e:
            # Commands may fail without real devices — that's expected
            pytest.skip(f"Command not available in test environment: {e}")


class TestCmdArchiveallalarms:
    """Test the 'archive-all-alarms' command via evtmgr."""

    def test_archive_all_alarms(self, authenticated_client):
        """Execute archive-all-alarms and verify response."""
        payload = {"cmd": "archive-all-alarms"}
        try:
            result = authenticated_client.api_post("cmd/evtmgr", payload)
            assert result is not None
        except (RuntimeError, httpx.HTTPStatusError) as e:
            # Commands may fail without real devices — that's expected
            pytest.skip(f"Command not available in test environment: {e}")


class TestCmdGetadmins:
    """Test the 'get-admins' command via sitemgr."""

    def test_get_admins(self, authenticated_client):
        """Execute get-admins and verify response."""
        payload = {"cmd": "get-admins"}
        try:
            result = authenticated_client.api_post("cmd/sitemgr", payload)
            assert result is not None
        except (RuntimeError, httpx.HTTPStatusError) as e:
            # Commands may fail without real devices — that's expected
            pytest.skip(f"Command not available in test environment: {e}")

