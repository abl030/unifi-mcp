"""Integration tests for REST route endpoint (auto-generated).

DO NOT EDIT THIS FILE. All changes must be made in the generator.
"""

from __future__ import annotations

import time
import uuid

import httpx
import pytest


class TestRouteHardwareDependent:
    """Tests for route — requires hardware for full CRUD."""

    def test_list_routes(self, authenticated_client):
        """Verify listing routes returns 200 + valid data."""
        data = authenticated_client.api_get("rest/routing")
        assert isinstance(data, list)

    def test_create_validates_input(self, authenticated_client):
        """Verify create endpoint exists and validates input correctly.

        Without physical hardware (gateway/AP), full CRUD is not possible.
        Instead we verify the endpoint is reachable and returns an expected
        error, proving the API surface works.
        """
        unique = uuid.uuid4().hex[:8]
        create_data = {
            "name": f"test_route_{unique}",
            "type": "static-route",
            "static-route_network": "10.99.99.0/24",
            "static-route_nexthop": "192.168.1.1",
            "enabled": True,
        }

        # Send request directly to inspect the response
        resp = authenticated_client.client.post(
            f"/api/s/{authenticated_client.site}/rest/routing",
            json=create_data,
            headers=authenticated_client._headers(),
        )
        # Without hardware: 400 (validation error) or 500 (no gateway) are expected.
        # 200 means hardware exists and create succeeded — also fine.
        assert resp.status_code in (200, 400, 500), (
            f"Unexpected status {resp.status_code} from rest/routing create"
        )
        if resp.status_code == 200:
            # Clean up if it unexpectedly succeeded
            body = resp.json()
            if isinstance(body, dict) and body.get("data"):
                resource_id = body["data"][0].get("_id")
                if resource_id:
                    authenticated_client.api_delete(f"rest/routing/{resource_id}")
